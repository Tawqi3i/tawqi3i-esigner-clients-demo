@page "/sanad1"
@using ESignerDemoWasmApp.Client.Services

@rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false))

@inject NavigationManager Navigation
@inject ApiService ApiService

<h3>Demo 1: ESigner SANAD Authentication & Signing</h3>
<br />
<div style="width:500px;">
    <div class="d-flex flex-column w-75">
        <button class="btn btn-primary m-2" onclick="@LoginHandler">Authenticate
            @if (IsLoading)
            {
                <div class="spinner-border spinner-border-sm text-light" role="status" />
            }
        </button>

        @if (IsAuthenticated)
        {
            <div class="form-group m-2">
                <label for="nationalId">National ID</label>
                <input type="text" class="form-control" id="nationalId" placeholder="Enter Jordanian National Id (10 Digits)" @bind="NationalId">
            </div>
            <button class="btn btn-success m-2" onclick="@StartSignHandler">SANAD Authentication</button>
        }
    </div>
</div>
@* 
<br />
<div class="container border border-2 ms-0">
    <div class="row">
        <div class="col-4">
            <p class="m-2">Step 1</p>
        </div>
        <div class="col-8">
            <button class="btn btn-success m-2" onclick="@LoginHandler">Authenticate</button>
        </div>
    </div>
    <div class="row">
        <div class="col-4">
            <p class="m-2">Step 1</p>
        </div>
        <div class="col-8">
            <button class="btn btn-success m-2" onclick="@LoginHandler">Authenticate</button>
        </div>
    </div>
    <div class="row">
        <div class="col-4">
            <p class="m-2">Step 1</p>
        </div>
        <div class="col-8">
            <button class="btn btn-success m-2" onclick="@LoginHandler">Authenticate</button>
        </div>
    </div>
</div> *@

@code {

    private bool IsAuthenticated => ApiService.IsLoggedIn;

    private string NationalId { get; set; } = "9831004432";

    private bool IsLoading { get; set; } = false;

    private async void LoginHandler()
    {
        IsLoading = true;

        this.StateHasChanged();
        
        await this.ApiService.Login();
        
        IsLoading = false;

        this.StateHasChanged();
    }

    /// <summary>
    /// Demonstrate SANAD authentication & signing workflow.
    /// </summary>
    private async void StartSignHandler()
    {
        if (string.IsNullOrEmpty(NationalId) || NationalId.Length != 10)
        {
            return;
        }

        var resp = await this.ApiService.SanadInit(NationalId);

        Navigation.NavigateTo(resp.AuthUrl);

        this.StateHasChanged();
    }
}
